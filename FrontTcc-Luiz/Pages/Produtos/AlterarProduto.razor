@page "/produtos-editaveis"
@using FrontTcc_Luiz.ViewModels
@inject ProdutosViewModel VM

<h1>Produtos Editáveis</h1>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Nome</th>
            <th>Categoria</th>
            <th>Preço</th>
            <th>Estoque</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var produto in VM.Produtos)
        {
            <tr>
                @if (produto.EmEdicao)
                {
                    <td><input @bind="produto.Nome" /></td>
                    <td><input @bind="produto.Categoria" /></td>
                    <td><input type="number" step="0.01" @bind="produto.Preco" /></td>
                    <td><input type="number" @bind="produto.Estoque" /></td>
                    <td>
                        <button class="btn btn-success btn-sm" @onclick="() => SalvarProduto(produto)">💾 Salvar</button>
                        <button class="btn btn-secondary btn-sm" @onclick="() => CancelarEdicao(produto)">❌ Cancelar</button>
                    </td>
                }
                else
                {
                    <td>@produto.Nome</td>
                    <td>@produto.Categoria</td>
                    <td>R$ @produto.Preco</td>
                    <td>@produto.Estoque</td>
                    <td>
                        <button class="btn btn-warning btn-sm" @onclick="() => EditarProduto(produto)">✏️ Editar</button>
                        <button class="btn btn-danger btn-sm" @onclick="() => ExcluirProduto(produto)">🗑️ Excluir</button>
                    </td>
                }
            </tr>
        }
    </tbody>
</table>

@code {

    protected override void OnInitialized()
    {
        VM.CarregarProdutos();
    }

    void EditarProduto(ProdutosViewModel produto)
    {
        produto.EmEdicao = true;

        produto.Backup = new ProdutosViewModel
            {
                Nome = produto.Nome,
                Categoria = produto.Categoria,
                Preco = produto.Preco,
                Estoque = produto.Estoque
            };
    }

    void SalvarProduto(ProdutosViewModel produto)
    {
        produto.EmEdicao = false;
        produto.Backup = null;
    }

    void CancelarEdicao(ProdutosViewModel produto)
    {
        if (produto.Backup == null) return;

        produto.Nome = produto.Backup.Nome;
        produto.Categoria = produto.Backup.Categoria;
        produto.Preco = produto.Backup.Preco;
        produto.Estoque = produto.Backup.Estoque;

        produto.EmEdicao = false;
        produto.Backup = null;
    }

    void ExcluirProduto(ProdutosViewModel produto)
    {
        VM.Produtos.Remove(produto);
    }
}
